<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>affitti brevi</title>

    <!-- Link a Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/dbc18cb8dd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.6/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.6/js/jquery.dataTables.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.25/sorting/datetime-moment.js"></script>
    <script type="text/javascript" src="/path/to/jquery-latest.js"></script>
    <script type="text/javascript" src="/path/to/jquery.tablesorter.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="/path/to/jquery.tablesorter.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">

    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>

    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <!-- DataTables datetime-moment plugin -->
    <script src="https://cdn.datatables.net/plug-ins/1.10.21/sorting/datetime-moment.js"></script>

    <style>
        body {
            line-height: 1;
            color: #134b67;
            font-family: 'Work Sans', sans-serif;
        }

        .container {
            margin-top: 50px;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 0px;
        }

        .Table-prenotat {
            height: 500px; /* Regola questa altezza secondo le tue esigenze */
            overflow-y: auto;
        }
        .prenotat-form {
            height: 300px; /* Regola questa altezza secondo le tue esigenze */
            margin-bottom: 10px;
        }
        h3 {
            text-transform: uppercase;
            text-align: center;
            color: #134b67;
            font-family: 'Work Sans', sans-serif;
            font-weight: 900;
        }
        
        .card-text {
            width: 300px; /* Imposta la larghezza desiderata */
            display: inline-block; /* Fai sì che l'elemento si comporti come un blocco inline */
        }

        .colored-box {
            background-color: #ffffff; /* Colore di sfondo del rettangolo */
            border-left: 5px solid #74add3; /* Colore della bordatura a sinistra */
        }
        .delete-button {
        background: none; /* Rimuove lo sfondo del bottone */
        border: none; /* Rimuove il bordo del bottone */
        padding: 0; /* Rimuove il padding del bottone */
        cursor: pointer; /* Cambia il cursore quando si passa sopra */
        font-size: 1.5rem; /* Imposta la dimensione dell'icona */
        margin-left: 10px;
    
        }
        .hidden {
        display: none;
        }
        .modify-button{
        background: none; /* Rimuove lo sfondo del bottone */
        border: none; /* Rimuove il bordo del bottone */
        padding: 0; /* Rimuove il padding del bottone */
        cursor: pointer; /* Cambia il cursore quando si passa sopra */
        font-size: 1.5rem; /* Imposta la dimensione dell'icona */
        margin-left: 10px;
        }
        .table-scrollable {
            overflow-x: auto;
            display: block;
        }

        /* Imposta la larghezza massima per la tabella */
        .table-scrollable table {
            min-width: 1500px;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg" style="background-color: #e3f2fd;" >
        <a class="navbar-brand" href="/">Home</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/Calendario"> Calendario</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/finanze">finanze</a>
                </li>
                <!-- Aggiungi altri link delle pagine se necessario -->
            </ul>
        </div>
    </nav>
    
    <h3>LISTA PRENOTAZIONI</h3>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card mb-3 colored-box">
                    <div class="card-body">                 
                        <div id="prenotat-form" class="pprenotat-form"> 
                            <form action="/aggiungi_prenotazione" method="post" class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="data_prenotazione">Data Prenotazione:</label>
                                    <input type="date" name="data_prenotazione" class="form-control" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="immobile">Immobile:</label>
                                    <select name="immobile" class="form-control" required>
                                        <option value="Santa">Santa Margherita Ligure</option>
                                        <option value="LaThuile">La Thuile</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="portale">Portale:</label>
                                    <select name="portale" class="form-control" required>
                                        <option value="Booking">Booking</option>
                                        <option value="AirBnb">AirBnb</option>
                                        <option value="Diretta">Prenotazione Diretta</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="numero">Numero Prenotazione:</label>
                                    <input type="text" name="numero" class="form-control">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="nome_cognome">Nome e Cognome:</label>
                                    <input type="text" name="nome_cognome" class="form-control" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="numero_telefono">Numero di Telefono:</label>
                                    <input type="tel" name="numero_telefono" class="form-control">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="data_checkin">Data Check-In:</label>
                                    <input type="date" name="data_checkin" class="form-control" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="data_checkout">Data Check-Out:</label>
                                    <input type="date" name="data_checkout" class="form-control" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="numero_ospiti">Numero Ospiti:</label>
                                    <input type="number" name="numero_ospiti" class="form-control" step="0.1">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="totale_lordo">Totale Lordo:</label>
                                    <input type="number" name="totale_lordo" class="form-control" step="0.01">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="no_tax">Importo No Tax:</label>
                                    <input type="number" name="no_tax" class="form-control" step="0.01">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="commissioni">Commissioni:</label>
                                    <input type="number" name="commissioni" class="form-control" step="0.01">
                                </div>
                                
                                <div class="form-group col-md-12">
                                    <input type="submit" class="btn btn-primary" value="Aggiungi Prenotazione">
                                </div>
                            </form>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    

    <div class="col-12">
        <div class="card">
          <div class="table-responsive">
            <table class="table">
              <thead class="table-light">
                          <tr>
                                        <th>ID</th>
                                        <th>Data Prenotazione</th>
                                        <th>Immobile</th>
                                        <th>Portale</th>
                                        <th>Numero</th>
                                        <th>Nome e Cognome</th>
                                        <th>Numero di Telefono</th>
                                        <th>Data Check-In  </th>
                                        <th>Data Check-Out</th>
                                        <th>Numero Ospiti</th>
                                        <th>Totale Lordo</th>
                                        <th>No Tax</th>
                                        <th>Commissioni</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for reservation in reservations %}
                                        <tr>
                                            <td>{{ reservation.id }}</td>
                                            <td     name="nuovo_data_prenotazione">{{ reservation.data_prenotazione }}</td>
                                            <td     name="nuovo_immobile">{{ reservation.immobile }}</td>
                                            <td     name="nuovo_portale">{{ reservation.portale }}</td>
                                            <td     name="nuovo_numero">{{ reservation.numero }}</td>
                                            <td     name="nuovo_nome_cognome">{{ reservation.nome_cognome }}</td>
                                            <td     name="nuovo_numero_telefono">{{ reservation.numero_telefono }}</td>
                                            <td     name="nuovo_data_checkin">{{ reservation.data_checkin }}</td>
                                            <td     name="nuovo_data_checkout">{{ reservation.data_checkout }}</td>
                                            <td     name="nuovo_numero_ospiti">{{ reservation.numero_ospiti }}</td>
                                            <td     name="nuovo_totale_lordo">{{ reservation.totale_lordo }} €</td>
                                            <td     name="nuovo_no_tax">{{ reservation.no_tax }} €</td>
                                            <td     name="nuovo_commissioni">{{ reservation.commissioni }} €</td>
                                            <td>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <a href="{{ url_for('modifica_prenotazione', id=reservation.id) }}" class="btn btn-warning btn-sm"><i class="fa-solid fa-pen-to-square"></i></a>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <form action="{{ url_for('elimina_prenotazione', id=reservation.id) }}" method="post" class="d-inline">
                                                            <input type="hidden" name="_method" value="delete">
                                                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Sei sicuro di voler eliminare questa prenotazione?')"><i class="fas fa-trash-alt"></i></button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </td>
                                    {% endfor %}
                                </tbody>
                            </table>
                            </div>
                        </div>
                    </div>
                

    </div>

    <!-- Link a Bootstrap JS e Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> 
    <script>
        function confermaEliminazione() {
            return confirm("Sei sicuro di voler eliminare questa prenotazione?");
        }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Seleziona tutte le righe della tabella tranne l'intestazione
            var rows = document.querySelectorAll("table tr:not(:first-child)");
    
            rows.forEach(function (row) {
                var dataCheckin = new Date(row.cells[7].textContent); // L'indice 7 rappresenta la colonna della data check-in
                var dataCheckout = new Date(row.cells[8].textContent); // L'indice 8 rappresenta la colonna della data check-out
                var oggi = new Date();
    
                if (dataCheckin < oggi && dataCheckout > oggi) {
                    // La data di check-in è passata e la data di check-out è nel futuro
                    row.style.backgroundColor = "orange";
                } else if (dataCheckout < oggi) {
                    // La data di check-out è passata
                    row.style.backgroundColor = "rgba(67, 204, 127, 0.7)";
                }
            });
        });
    </script>
    <script>
        $(document).ready(function () {
          $(".modify-button").on("click", function () {
            // Nascondi le celle non modificabili e mostra i campi di input
            $(this).closest("tr").find("[contenteditable]").hide();
            $(this).closest("tr").find("input, select").show();
          });
        });
      </script>
      <script>
$(".modify-button").on("click", function () {
    var row = $(this).closest("tr");

    // Popola i campi nascosti con i valori corrispondenti
    row.find("[name=nuovo_data_prenotazione]").val(row.find("[name=nuovo_data_prenotazione]").html().trim());
    row.find("[name=nuovo_immobile]").val(row.find("[name=nuovo_immobile]").html().trim());
    row.find("[name=nuovo_portale]").val(row.find("[name=nuovo_portale]").html().trim());
    row.find("[name=nuovo_numero]").val(row.find("[name=nuovo_numero]").html().trim());
    row.find("[name=nuovo_nome_cognome]").val(row.find("[name=nuovo_nome_cognome]").html().trim());
    row.find("[name=nuovo_numero_telefono]").val(row.find("[name=nuovo_numero_telefono]").html().trim());
    row.find("[name=nuovo_data_checkin]").val(row.find("[name=nuovo_data_checkin]").html().trim());
    row.find("[name=nuovo_data_checkout]").val(row.find("[name=nuovo_data_checkout]").html().trim());
    row.find("[name=nuovo_numero_ospiti]").val(row.find("[name=nuovo_numero_ospiti]").html().trim());
    row.find("[name=nuovo_totale_lordo]").val(row.find("[name=nuovo_totale_lordo]").html().trim());
    row.find("[name=nuovo_no_tax]").val(row.find("[name=nuovo_no_tax]").html().trim());
    row.find("[name=nuovo_commissioni]").val(row.find("[name=nuovo_commissioni]").html().trim());

    // Invia il form
    row.find("form").submit();
});
      </script>
      <script>
            $(document).ready(function () {
        $(".modify-button").on("click", function () {
            // Nascondi/mostra i campi aggiuntivi quando si fa clic su Modifica
            $(this).closest("tr").find("[name^=nuovo_]").toggleClass("hidden");
            $(this).closest("tr").find("input, select").not("[name^=nuovo_]").toggle();
        });
    });
      </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".modify-form").forEach(function (form) {
                form.addEventListener("submit", function (event) {
                    event.preventDefault();  // Evita l'invio del form
                    // Aggiungi qui la logica per gestire la modifica del form
                });
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".delete-button").forEach(function (button) {
                button.addEventListener("click", function (event) {
                    if (!confirm("Sei sicuro di voler eliminare questa prenotazione?")) {
                        event.preventDefault();  // Annulla l'azione predefinita (eliminazione)
                    }
                });
            });
        });
    </script>
</body>
</html>
